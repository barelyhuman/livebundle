# To be run from top level workspace directory to build a development image

# Unfortunately can't use node:12-alpine here as it makes the image
# non buildable from a Walmart development machine (even if not connected to VPN)
# as proxy blocks http://dl-cdn.alpinelinux.org/alpine/v3.11/main/x86_64/APKINDEX.tar.gz
# retrieved when running `apk add --no-cache git`
# Reached out to team for adding exclusion. Meanwhile using fat node image.
FROM node:12

# Line below is only of use when using node:12-alpine
# See comment above
# RUN apk add --no-cache git
WORKDIR /usr/src/app
COPY ["package.json", "yarn.lock", "./"]
COPY ./packages ./packages
RUN yarn workspace livebundle-github install --prod
EXPOSE 3000
ENV DEBUG *,-babel*
WORKDIR /usr/src/app/packages/livebundle-github
CMD ["yarn", "start"]